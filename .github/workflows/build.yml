name: Build CutsceneMaker

permissions:
    contents: write

on:
    push:
        branches: [ main ]

jobs:
    build:
        runs-on: windows-latest

        steps:
        - uses: actions/checkout@v4.1.1
          with:
            submodules: recursive
        - uses: actions/setup-dotnet@v4.0.0
          with:
            dotnet-version: '8.x.x'
        - shell: cmd
          run: mkdir CutsceneMaker-linux CutsceneMaker-macos CutsceneMaker-win
        - shell: cmd
          working-directory: CutsceneMaker
          run: |
            dotnet restore
            dotnet publish -p:PublishProfile=Properties\PublishProfiles\Linux.pubxml
            dotnet publish -p:PublishProfile=Properties\PublishProfiles\MacOS.pubxml
            dotnet publish -p:PublishProfile=Properties\PublishProfiles\Windows.pubxml
        - shell: cmd
          working-directory: CutsceneMaker\bin\Release\net8.0\publish
          run: |
            xcopy /s linux-x64 ${{ github.workspace }}\CutsceneMaker-linux
            xcopy /s osx-x64 ${{ github.workspace }}\CutsceneMaker-macos
            xcopy /s win-x64 ${{ github.workspace }}\CutsceneMaker-win
        - shell: cmd
          run: |
            7z a CutsceneMaker-linux.zip CutsceneMaker-linux
            7z a CutsceneMaker-macos.zip CutsceneMaker-macos
            7z a CutsceneMaler-win.zip CutsceneMaker-win
        - uses: "marvinpinto/action-automatic-releases@latest"
          with:
            repo_token: "${{ secrets.GITHUB_TOKEN }}"
            automatic_release_tag: auto
            title: "Auto"
            prerelease: false
            files: |
                *.zip
